webpackJsonp([3],{1793:function(t,e,n){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(1794),o=function(){function t(t,e){var n=[],a=!0,i=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(a=(r=s.next()).done)&&(n.push(r.value),!e||n.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),s={duration:-1,speed:100,fontSize:24,fontFamily:"Microsoft Yahei",textShadowBlur:1,opacity:1,defaultColor:"#fff"},c={type:null,mask:null},h=function(){function t(e){var n=e.container,i=e.data,o=void 0===i?[]:i,r=e.config,c=void 0===r?{}:r,h=e.overlapOptimized,f=void 0!==h&&h,d=e.mask,u=void 0===d?[]:d,l=e.beforeRender,m=void 0===l?function(){}:l,v=e.afterRender,p=void 0===v?function(){}:v;a(this,t),this.parent="string"===typeof n?document.getElementById(n):n,this.parent.classList.add("barrage-container"),this.canvas=document.createElement("canvas"),this.canvas.className="barrage-canvas",this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientHeight,this.canvas.style.pointerEvents="none",this.canvas.style.letterSpacing="1.5px",this.parent.appendChild(this.canvas),this.parent.childNodes.length>1&&(this.parent.style.position="relative",this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px"),this.ctx=this.canvas.getContext("2d"),this.overlapOptimized=f,this.setConfig(Object.assign({},s,c)),this.setMask(u),this.beforeRender=m,this.afterRender=p,this.setData(o)}return r(t,[{key:"setMask",value:function(t){"string"===typeof t?(c.type="url",Object(i.b)(t).then(function(t){c.data=t})):"[object ImageData]"===Object.prototype.toString.apply(t)?(c.type="ImageData",c.data=t):(c.type=null,c.data=null)}},{key:"clearMask",value:function(){this.setMask()}},{key:"setConfig",value:function(t){this.config||(this.config={});var e=!0,n=!1,a=void 0;try{for(var i,r=Object.entries(t)[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var c=i.value,h=o(c,2),f=h[0],d=h[1];s[f]&&(this.config[f]=d)}}catch(t){n=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(n)throw a}}}},{key:"_randomTop",value:function(){return this.rowCount=this.rowCount||Math.floor(this.canvas.height/(1.32*this.config.fontSize)),this.config.fontSize*(1.32-1)/2+1.32*Math.floor(this.rowCount*Math.random())*this.config.fontSize}},{key:"_optimizeData",value:function(){if(this.data){var t=!0,e=!1,n=void 0;try{for(var a,i=this.data[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,r=!0,s=!1,c=void 0;try{for(var h,f=this.data[Symbol.iterator]();!(r=(h=f.next()).done);r=!0){var d=h.value;(Math.abs(d.top-o.top)<.1*this.config.fontSize&&d.left>=o.left&&d.left<=o.left+o.width||Math.abs(d.top-o.top)<.1*this.config.fontSize&&d.left+d.width>=o.left&&d.left+d.width<=o.left+o.width)&&(d.top=this._randomTop())}}catch(t){s=!0,c=t}finally{try{!r&&f.return&&f.return()}finally{if(s)throw c}}}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}}},{key:"setData",value:function(t){var e=this;this.data&&(this.prevData=this.data),this.data=t.map(function(t){var n=t.key,a=t.time,i=t.text,o=t.fontSize,r=void 0===o?e.config.fontSize:o,s=t.fontFamily,c=void 0===s?e.config.fontFamily:s,h=t.color,f=void 0===h?e.config.defaultColor:h,d=t.createdAt,u=void 0===d?(new Date).toISOString():d;if(e.prevData&&e.prevData.some(function(t){return t.key===n}))return e.prevData.find(function(t){return t.key===n});e.ctx.font=r+"px "+c;var l=e.ctx.measureText(i),m=l.width;return{key:n,time:a,text:i,fontSize:r,fontFamily:c,color:f,createdAt:u,left:e.config.speed*a/1e3+e.canvas.width,top:e._randomTop(),width:m,height:e.config.fontSize,speedRatio:Math.random()+1}}),this.overlapOptimized&&this._optimizeData()}},{key:"add",value:function(t){var e=t.time,n=t.text,a=t.fontSize,i=void 0===a?this.config.fontSize:a,o=t.fontFamily,r=void 0===o?this.config.fontFamily:o,s=t.color,c=void 0===s?this.config.defaultColor:s,h=t.createdAt,f=void 0===h?(new Date).toISOString():h;this.ctx.font=i+"px "+r;var d=this.ctx.measureText(n),u=d.width,l={time:e,text:n,fontSize:i,fontFamily:r,color:c,createdAt:f,left:this.config.speed*e/1e3+this.canvas.width,top:this._randomTop(),width:u,height:this.config.fontSize,speedRatio:Math.random()+1};this.data&&this.data.length?this.data.push(l):this.setData([l])}},{key:"_render",value:function(){var t=this,e=this.config.speed*this.progress/1e3;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var n=this.data.filter(function(n){return n.left+n.width-e*n.speedRatio>=0&&n.left-e*n.speedRatio<t.canvas.width}).sort(function(t,e){return new Date(t.createdAt)-new Date(e.createdAt)});this.beforeRender&&this.beforeRender(this.ctx,this.progress,this.animState),this.ctx.save(),c.data&&("ImageData"===c.type?this.ctx.putImageData(c.data,0,0):"url"===c.type&&this.ctx.drawImage(c.data,0,0,this.canvas.width,this.canvas.height),this.anotherCanvas?this.anotherContext.clearRect(0,0,this.anotherCanvas.width,this.anotherCanvas.height):(this.anotherCanvas=document.createElement("canvas"),this.anotherCanvas.width=this.canvas.width,this.anotherCanvas.height=this.canvas.height,this.anotherContext=this.anotherCanvas.getContext("2d")));var a=c.data?this.anotherContext:this.ctx;a.globalAlpha=this.config.opacity,a.shadowColor="rgba(0, 0, 0, 1)",a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=2*this.config.textShadowBlur,a.textBaseline="top",n.forEach(function(t){a.font=t.fontSize+"px "+t.fontFamily,a.fillStyle=t.color,a.fillText(t.text,t.left-e*t.speedRatio,t.top)}),c.data&&(this.ctx.globalCompositeOperation="source-in",this.ctx.drawImage(this.anotherCanvas,0,0,this.canvas.width,this.canvas.height)),this.ctx.restore(),this.afterRender&&this.afterRender(this.ctx,this.progress,this.animState),this.animation&&Object(i.c)(function(){return t._render()})}},{key:"_play",value:function(){var t=this;this.animation||(this.animation=Object(i.c)(function(){return t._render()}))}},{key:"goto",value:function(t){void 0!==this.pauseAt&&(this.pauseAt=void 0),this.startTime=Date.now()-t,this.animation||this._render()}},{key:"play",value:function(){this.startTime||(this.startTime=Date.now()),void 0!==this.pauseAt&&(this.goto(this.pauseAt),this.pauseAt=void 0),this._play()}},{key:"replay",value:function(){this.startTime=Date.now(),void 0!==this.pauseAt&&(this.pauseAt=void 0),this._play()}},{key:"pause",value:function(){this.animation&&(Object(i.a)(this.animation),this.animation=void 0,this.pauseAt=Date.now()-this.startTime)}},{key:"progress",get:function(){if(!this.startTime)return 0;if(void 0!==this.pauseAt)return this.pauseAt;var t=Date.now()-this.startTime;return this.config.duration>0&&(t%=this.config.duration),t}},{key:"animState",get:function(){return this.startTime?void 0!==this.pauseAt?"paused":"playing":"ready"}}]),t}();e.a=h},1794:function(t,e,n){"use strict";n.d(e,"b",function(){return a}),n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o});var a=function(t){var e=new Image;return e.src=t,new Promise(function(t,n){e.onload=function(){t(e)},e.onerror=function(){n()}})},i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame},1795:function(t,e,n){"use strict";var a=n(1796),i=n.n(a),o=function(){return new Array(2).fill(0).map(function(){return Math.random().toString(32).slice(2)}).join("")},r=["#f00","#0f0","#ff0","#fff","#fff","#fff","#fff"],s=function(){return r[Math.floor(6*Math.random())]},c=function(){return i.a[Math.floor(i.a.length*Math.random())].text},h=Date.now(),f=new Array(5e3).fill(null).map(function(t,e){return{key:o(),time:200*(e+Math.random()),text:c(),color:s(),createdAt:h+24*Math.random()*3600*1e3}});e.a=f},1796:function(t,e){t.exports=[{key:"7g43mm0rpp1l67eh6qjo8",time:500,text:"\u7eff\u8272\u8d70\u4e00\u6ce2",color:"#0f0",createdAt:"2019-01-13T13:34:47.126Z"},{key:"n8alq5l22d8qqbuhgst68g",time:1200,text:"\u6211\u81a8\u80c0\u4e86",fontFamily:"SimSun",fontSize:32,color:"yellow",createdAt:"2019-01-13T13:34:47.126Z"},{key:"atb8ctt81egh8hf45u7n2g",time:2500,text:"\u5988\u5988\u54aa\u5440",createdAt:"2019-01-13T13:34:47.126Z"},{key:"bl9a602defoehsiahgi7vo",time:3300,text:"\u5bcc\u8d35\u4f7f\u6211\u4eec\u76f8\u9047",createdAt:"2019-01-13T13:34:47.126Z"},{key:"p0su7gh4s88fjtqv0bmdog",time:4e3,text:"\u8981\u60f3\u751f\u6d3b\u8fc7\u5f97\u53bb",color:"#0f0",createdAt:"2019-01-13T13:34:47.126Z"},{key:"udfel3ppv5ggrfqo4nlbng",time:4400,text:"\u4f60\u4e14\u5728\u8fd9\u91cc\u4e0d\u8981\u8d70\u52a8\uff0c\u5f85\u6211\u53bb\u4e70\u4e24\u65a4\u6a58\u5b50",color:"#f00",createdAt:"2019-01-13T13:34:47.126Z"},{key:"68ts93rle7gtv1i9die5ig",time:4800,text:"\u6211\u4eec\u90fd\u4e00\u6837",createdAt:"2019-01-13T13:34:47.126Z"},{key:"dcprmrcmdcg4btqej0mung",time:5200,text:"Remember me",createdAt:"2019-01-13T13:34:47.126Z"},{key:"9jgn02iii6b8qmkq2v2hg",time:5680,text:"LoL",createdAt:"2019-01-13T13:34:47.126Z"},{key:"im73i1lka0ooavb86gb048",time:6600,text:"(-_-)|||",createdAt:"2019-01-13T13:34:47.126Z"},{key:"hrbvbcuekoqm7aacufgk8",time:7200,text:"\u5929\u54ea\u565c",createdAt:"2019-01-13T13:34:47.126Z"},{key:"f95vsgh50qob6ip3r617b",time:8300,text:"\u5bcc\u5f3a \u6c11\u4e3b \u6587\u660e \u548c\u8c10 \u81ea\u7531 \u5e73\u7b49 \u516c\u6b63 \u6cd5\u6cbb \u7231\u56fd \u656c\u4e1a \u8bda\u4fe1 \u53cb\u5584",color:"#f00",createdAt:"2019-01-13T13:34:47.126Z"},{key:"u7bo393jvv8dkccb2ml0e",time:9210,text:"\u5566\u5566\u5566\u5566\u5566\u5566\u5566\u62c9",createdAt:"2019-01-13T13:34:47.126Z"},{key:"muafgllnsg20op35brg9",time:1e4,text:"\u6211\u662f\u8c01 \u6211\u4ece\u54ea\u91cc\u6765 \u6211\u4e3a\u4ec0\u4e48\u8981\u770b\u8fd9\u4e2a",createdAt:"2019-01-13T13:34:47.126Z"},{key:"hjv3sllm12tbh85r2qor8",time:12e3,text:"2333333333333333",createdAt:"2019-01-13T13:34:47.126Z"},{key:"r7u5mvu1l7g1hk7cvnddig",time:12e3,text:"2333333333333333",createdAt:"2019-01-13T13:34:47.126Z"},{key:"0o51j9psnj8qn3bnfq9kag",time:12e3,text:"2333333333333333",createdAt:"2019-01-13T13:34:47.126Z"},{key:"fkgm2nerakgr71jloi9d38",time:12e3,text:"2333333333333333",createdAt:"2019-01-13T13:34:47.126Z"}]},1797:function(t,e,n){var a=n(1798);"string"===typeof a&&(a=[[t.i,a,""]]);var i={};i.transform=void 0;n(478)(a,i);a.locals&&(t.exports=a.locals)},1798:function(t,e,n){e=t.exports=n(477)(!0),e.push([t.i,".danmaku-container,.danmaku-video{width:880px;height:540px}.danmaku-container{margin:0 auto;margin-top:50vh;margin-left:50vw;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#ddd}.danmaku-video::-webkit-media-controls-fullscreen-button{display:none}","",{version:3,sources:["/Users/pengan/Desktop/blog/src/containers/MaskingDanmakuDemo/style.css"],names:[],mappings:"AAAA,kCAEE,YAAa,AACb,YAAc,CACf,AAED,mBACE,cAAe,AACf,gBAAiB,AACjB,iBAAkB,AAClB,uCAAyC,AACrC,mCAAqC,AACjC,+BAAiC,AACzC,qBAAuB,CACxB,AAED,yDACE,YAAc,CACf",file:"style.css",sourcesContent:[".danmaku-container,\n.danmaku-video {\n  width: 880px;\n  height: 540px;\n}\n\n.danmaku-container {\n  margin: 0 auto;\n  margin-top: 50vh;\n  margin-left: 50vw;\n  -webkit-transform: translate(-50%, -50%);\n      -ms-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  background-color: #ddd;\n}\n\n.danmaku-video::-webkit-media-controls-fullscreen-button {\n  display: none;\n}\n"],sourceRoot:""}])},482:function(t,e,n){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function o(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),s=n.n(r),c=n(1793),h=n(1795),f=n(1797),d=(n.n(f),function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}()),u={width:880,height:540},l=function(t){function e(){return a(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),d(e,[{key:"componentDidMount",value:function(){var t=this,e=new c.a({container:this.container,config:{overlapOptimized:!0}});e.canvas.width=u.width,e.canvas.height=u.height-80,e.setData(h.a);var n=document.createElement("canvas");n.width=u.width,n.height=u.height;var a=n.getContext("2d");e.afterRender=function(){a.drawImage(t.video,0,0,n.width,n.height)},e.beforeRender=function(){for(var t=a.getImageData(0,0,n.width,n.height),i=t.data.length/4,o=0;o<i;o++){var r=t.data[4*o+0],s=t.data[4*o+1],c=t.data[4*o+2];(r>15||s>15||c>15)&&(t.data[4*o+3]=0)}e.setMask(t)},this.video.addEventListener("play",function(){e.play()},!1),this.video.addEventListener("pause",function(){e.pause()},!1),this.video.addEventListener("seeked",function(){e.goto(1e3*t.video.currentTime)},!1)}},{key:"render",value:function(){var t=this;return s.a.createElement("div",{className:"danmaku-container",ref:function(e){t.container=e}},s.a.createElement("video",{className:"danmaku-video",ref:function(e){t.video=e},src:"videos/demo.mp4",controls:!0}))}}]),e}(r.Component);e.default=l}});
//# sourceMappingURL=3.482b6cf8.chunk.js.map